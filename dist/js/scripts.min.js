!function(){var n="spinner-",t=function(){var n=[],t=["title","lastEditionKey","authors"];function i(i){!function(n){var i=Object.keys(n);return"object"==typeof n&&t.length===i.length&&t.every(function(n){return i.indexOf(n)>=0})}(i)?console.error("Error: you are trying to add a non valid object to the repository"):n.push(i)}return{add:i,getAll:function(){return n},filter:function(t){return n.filter(function(n){return n.title===t})},searchBooks:function(n,t=10){var o=encodeURIComponent(n);return fetch(`https://openlibrary.org/search.json?q=${o}&limit=${t}`).then(function(n){return n.json()}).then(function(n){n.docs.forEach(function(n){i({title:n.title,lastEditionKey:n.edition_key[n.edition_key.length-1],authors:n.author_name})})}).catch(function(n){console.error(n)})},loadDetails:function(n){var t=`https://openlibrary.org/api/books.json?bibkeys=${n.lastEditionKey}`;return $.ajax(t,{dataType:"json"}).done(function(t){n.thumbnailUrl=t[n.lastEditionKey].thumbnail_url,n.previewUrl=t[n.lastEditionKey].preview_url}).fail(function(n){console.error(n)})},clear:function(){n=[]}}}(),i=function(){var n=$("#modal-container");function t(){n.velocity({opacity:0},{complete:function(n){n.forEach(function(n){$(n).removeClass("is-visible")})}})}return{show:function({title:i,authors:o,thumbnailUrl:e,previewUrl:r}){n.empty();var a=$('<div class="modal"></div>'),s=$('<button class="modal-close">Close</button>');s.on("click",t),a.append(s);var l=$(`<h1>${i}</h1>`);a.append(l),e=e?e.replace("-S.jpg","-M.jpg"):"img/no-image.jpg";var c=$(`<img src="${e}" alt="${i}">`);if(a.append(c),o){o=o.filter(n=>"null"!=n.toLowerCase()).join(", ");var u=$(`<p>Author(s): ${o}</p>`);a.append(u)}n.append(a),n.on("click",i=>{$(i.target).is(n)&&t()}),n.addClass("is-visible").velocity({opacity:1})},hide:t,isVisible:function(){return n.hasClass("is-visible")}}}();function o(o){var e=function({lastEditionKey:t}){var i=$("#"+n+t);return i&&i.addClass("button-spinner"),i}(o);t.loadDetails(o).done(function(){i.show(o)}).always(function(){!function(n){n.removeClass("button-spinner")}(e)})}function e(i,e){!function(n){n.empty()}(e),t.clear(),t.searchBooks(i).then(function(){var i=t.getAll();0==i.length?function(n){var t=$('<li class="books-list__item">No books found. Try again.</li>');n.append(t)}(e):i.forEach(function(t){!function(t,i){var{title:e,lastEditionKey:r}=t,a=$('<li class="books-list__item"></li>'),s=$(`<button>${e}</button>`),l=$(`<span id="${n+r}"></span>`);s.append(l),a.append(s),i.append(a),s.on("click",function(n){o(t)})}(t,e)})}).finally(function(){a.removeClass("list-spinner")})}var r=$(".books-list");if(r){var a=$("<div></div>");a.insertBefore(r),$("#search-form").on("submit",n=>{n.preventDefault();var t=$("#search-query").val();t.trim().length>0&&(!function(n){n.addClass("list-spinner")}(a),e(t,r))})}$(window).on("keydown",n=>{"Escape"===n.key&&i.isVisible()&&i.hide()})}();